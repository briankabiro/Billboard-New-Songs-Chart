<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<html lang="en">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Billboard Da Chart</title>
	</head>
	<body>
		<div id="container">
			<form>
				<label>Date</label>
				<input type="date" name="Week">
			</form>
			<button id="fetch">Get</button>
			<h3>New Songs</h3>
			<div id="results">			
			</div>
		</div>
		<script src="/socket.io/socket.io.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
		<script>
			var socket = io();
			$("#fetch").click(function(e){
				e.preventDefault();
				socket.emit('leta')
				return false;
			});
			socket.on('results',function(data){
				function getImage(url){
					return new Promise(function(resolve, reject){
						var img = new Image()
						img.onload = function(){
							resolve(url)
						}
						img.onerror = function(){
							reject(url)
						}
						img.src = url
					})
				}
				$(".results").html("")
				for(var key in data){
					var innerObject = data[key];
					var songsArray = innerObject["newsongs"]; 
					songsArray.forEach(function(song){
						getImage(song.cover).then(function(successurl){
							document.getElementbyId('results').innerHTML = '<img src="' + successurl + '" />'
						}).catch(err => {
							console.error(err)
						})
					})

				}
			})
		</script>
	</body>
</html>